<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: surfguru-parser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: surfguru-parser.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const puppeteer = require('puppeteer');


/** 
 * Scrap the beach with the given ID returing a array containing {@link Prediction} objects.
 *
 * @param {string} id - The ID of the beach to be scrapped.
 * @return {Promise&lt;Prediction[]>} An array containing the availiable predictions for the given beach.
 */
async function scrap(id) {
    if (!id) {
        throw new Error('Missing Location ID');
    }
    var browser;
    try {
        browser = await puppeteer.launch();
        const page = await browser.newPage();

        await page.goto(`https://www.windguru.cz/${id}`);
        return await page.evaluate(_getData);

    }
    catch (e) {
        throw new Error(e);
    } finally {
        browser.close();
    }
}

function _getData() {
    const data = [];
    const table = document.querySelector('#tabid_0_content_div .tabulka tbody');

    const dates = _getNumericData(table, '#tabid_0_0_dates');
    const waveHeight = _getNumericData(table, '#tabid_0_0_HTSGW');
    const waveDirection = _getDirectionalData(table, '#tabid_0_0_DIRPW');
    const windSpeed = _getNumericData(table, '#tabid_0_0_WINDSPD');
    const windDirection = _getDirectionalData(table, '#tabid_0_0_SMER');

    for (let index = 0; index &lt; dates.length; index++) {
        data.push({ d: dates[index], wah: waveHeight[index], wad: waveDirection[index], wis: windSpeed[index], wid: windDirection[index] });
    }

    return data;

    // Since this funcion is evaluated in the browser context we need to define the utilitiy functions here.

    function _getNumericData(table, selector) {
        const element = table.querySelector(selector);
        const data = [];
        element.childNodes.forEach(node => data.push(node.textContent));
        return data;
    }

    function _getDirectionalData(table, selector) {
        const element = table.querySelector(selector);
        const data = [];
        element.childNodes.forEach(node => {
            const title = node.querySelector('span') &amp;&amp; node.querySelector('span').title;
            if (title) {
                data.push(title.match(/\d+/)[0]);
            }
        });
        return data;
    }
}

/**
 *  Contains a surf forecast for a date.
 *  @typedef {Object} Prediction
 *  @property {string} date - The date of the prediction
 *  @property {number} wah - The predicted wave height in meters.
 *  @property {number} wad - The wave direction in degrees. (S 0º) (W 90º) (N 180º) (E 270º)
 *  @property {number} wis - The wind speed in knots.
 *  @property {number} wid - The wind direction. (S 0º) (W 90º) (N 180º) (E 270º)
 */
module.exports = scrap;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#scrap">scrap</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Oct 14 2017 13:34:40 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
